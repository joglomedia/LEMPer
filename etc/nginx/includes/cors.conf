## Enable CORS (Cross Origin Resource Sharing)
#
# Allow cross-origin requests.
# https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS
# https://enable-cors.org/
#
# USAGE: Include this file in your location {} block:
#   location /api {
#       include /etc/nginx/includes/cors.conf;
#   }
#
# IMPORTANT: You must define the $cors variable in your http {} block (nginx.conf)
# or server {} block before including this file:
#
#   # Allow specific origins (RECOMMENDED - more secure)
#   map $http_origin $cors {
#       default "";
#       "~^https?://(www\.)?example\.com$" "$http_origin";
#       "~^https?://(www\.)?example\.org$" "$http_origin";
#   }
#
#   # Or allow all origins (NOT RECOMMENDED for production)
#   map $http_origin $cors {
#       default "*";
#   }

# Common CORS headers
set $cors_methods "GET, POST, PUT, PATCH, DELETE, OPTIONS, HEAD";
set $cors_headers "Accept, Accept-Encoding, Accept-Language, Authorization, Cache-Control, Content-Type, DNT, If-Modified-Since, Keep-Alive, Origin, Range, User-Agent, X-Requested-With, X-Custom-Header";
set $cors_expose "Content-Length, Content-Range, X-Total-Count";
set $cors_max_age "86400";

# Handle preflight OPTIONS requests
if ($request_method = OPTIONS) {
    add_header Access-Control-Allow-Origin "$cors" always;
    add_header Access-Control-Allow-Methods "$cors_methods" always;
    add_header Access-Control-Allow-Headers "$cors_headers" always;
    add_header Access-Control-Max-Age "$cors_max_age" always;
    add_header Content-Type "text/plain; charset=utf-8" always;
    add_header Content-Length 0 always;
    return 204;
}

# Add CORS headers to actual requests (GET, POST, PUT, etc.)
add_header Access-Control-Allow-Origin "$cors" always;
add_header Access-Control-Allow-Methods "$cors_methods" always;
add_header Access-Control-Allow-Headers "$cors_headers" always;
add_header Access-Control-Expose-Headers "$cors_expose" always;

# Uncomment if you need to allow credentials (cookies, auth headers)
# WARNING: Cannot use "*" for Allow-Origin when Allow-Credentials is true
#add_header Access-Control-Allow-Credentials "true" always;
