## Directives to send expires headers and turn off 404 error logging for known static files.
# Designed to be included in any server {} block.
# Uses 'always' modifier to preserve security headers from parent context.

# Header setting for favicon.
location ~* favicon\.ico$ {
    add_header Pragma "public" always;
    add_header Cache-Control "public, max-age=2592000" always;
    access_log off;
    log_not_found off;
    expires 30d;
}

# Header setting for robots.txt.
location ~* robots\.txt$ {
    add_header Pragma "public" always;
    add_header Cache-Control "public, max-age=2592000" always;
    access_log off;
    log_not_found off;
    expires 30d;
}

# Header setting for rss/atom/json feeds.
location ~* \.(?:atom|feed|rss)$ {
    add_header Pragma "public" always;
    add_header Cache-Control "public, max-age=3600" always;
    access_log off;
    log_not_found off;
    expires 1h;
}

# Header setting for known static media files.
# Includes modern formats: AVIF, WebP, HEIC
location ~* \.(?:gif|jpe?g|png|webp|avif|heic|ico|cur|bmp|wmv|avi|asf|asx|ogg|ogv|3gp|mpg|mpeg|mp4|webm|pls|mp3|mid|wav|flv)$ {
    add_header Pragma "public" always;
    add_header Cache-Control "public, max-age=31536000, immutable" always;
    access_log off;
    log_not_found off;
    expires 1y;
}

# Header setting for archives and documents.
location ~* \.(?:swf|exe|zip|tar|rar|gz|tgz|bz2|uha|7z|doc|docx|xls|xlsx|ppt|pptx|rtf|rtx|txt|pdf|iso|dmg|pkg)$ {
    add_header Pragma "public" always;
    add_header Cache-Control "public, max-age=31536000" always;
    access_log off;
    log_not_found off;
    expires 1y;
}

# Header setting for js and css files (immutable for fingerprinted assets).
location ~* \.(?:css|htc|less|scss|sass|js|mjs|jsx|ts|tsx)$ {
    add_header Pragma "public" always;
    add_header Cache-Control "public, max-age=31536000, immutable" always;
    access_log off;
    log_not_found off;
    expires 1y;
}

# Header setting for font files.
location ~* \.(?:eot|otf|ttf|ttc|woff|woff2)$ {
    add_header Pragma "public" always;
    add_header Cache-Control "public, max-age=31536000, immutable" always;
    # CORS for fonts (required by some browsers)
    add_header Access-Control-Allow-Origin "*" always;
    access_log off;
    log_not_found off;
    expires 1y;
}

# Header setting for SVG files.
location ~* \.svgz?$ {
    add_header Pragma "public" always;
    add_header Cache-Control "public, max-age=31536000, immutable" always;
    access_log off;
    log_not_found off;
    expires 1y;
}

# Header setting for WebAssembly and JSON.
location ~* \.(?:wasm|json|map)$ {
    add_header Pragma "public" always;
    add_header Cache-Control "public, max-age=31536000, immutable" always;
    access_log off;
    log_not_found off;
    expires 1y;
}

# Header setting for manifest files.
location ~* \.(?:manifest|webmanifest|appcache)$ {
    add_header Pragma "public" always;
    add_header Cache-Control "public, max-age=604800" always;
    access_log off;
    log_not_found off;
    expires 7d;
}

## DO NOT CACHE static .html file by default,
# it is causing an 403 error on WordPress permalink structure that include .html extension on the link.
